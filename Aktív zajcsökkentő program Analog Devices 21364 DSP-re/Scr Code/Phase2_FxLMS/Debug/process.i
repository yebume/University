# 1 "process.c"
# 1 "tt.h"









# 1 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\cdef21364.h"






 

 





 





# 1 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"






 













 








# 58 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"


# 107 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"


# 155 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"


# 203 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"


# 217 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"


# 229 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"




# 248 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"







# 303 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"








# 317 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"






















# 346 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"









# 361 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"




 
# 378 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"
































# 421 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"

# 433 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"

# 445 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\Cdef21363.h"

# 22 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\cdef21364.h"

# 11 "tt.h"
# 1 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21364.h"






 










# 1 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



















 


























































































 





# 149 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"








# 185 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 234 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 282 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 330 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 344 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 356 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"




# 375 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"







# 430 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"








# 444 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"






















# 473 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"









# 488 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"





# 505 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"













# 529 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

# 541 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

# 553 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

# 565 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 574 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"





# 600 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 611 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 645 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

# 669 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 680 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

# 691 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 721 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 751 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 780 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 806 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 825 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

# 842 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"








# 867 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 892 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 915 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"






# 941 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"






# 954 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"







# 970 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 986 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1289 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1366 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"







# 1417 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1431 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1440 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1521 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"




























# 1555 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"








# 1583 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1605 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1636 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1651 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1678 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"




# 1708 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 1735 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"




# 1755 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"































# 1794 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"










# 1834 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1861 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 1883 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"






















# 1933 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

 
# 1942 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"







# 1981 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2015 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2026 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2052 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2086 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2120 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 2131 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



# 2158 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


            









# 2202 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2236 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"



 
# 2247 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

 
# 2256 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

 
# 2265 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

 
# 2274 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"

 










 










 










 










 





 





 





 








# 2378 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"


# 2412 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21363.h"











# 19 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\def21364.h"



# 12 "tt.h"
# 1 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"






 




# 40 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"

 

# 86 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"

 
 
# 160 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"

 

# 212 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"

 








# 246 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"
                                

                                
# 264 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"

# 294 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"






 


# 310 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\signal.h"








 

typedef int sig_atomic_t;





void (*signal(int _sig, void (*func)(int))) (int);
void (*signalf(int _sig, void (*func)(int))) (int);
void (*signals(int _sig, void (*func)(int))) (int);
void (*signalcb(int _sig, void (*func)(int))) (int);
void (*signalss(int _sig, void (*func)(int))) (int);

void (*signalnsm(int _sig, void (*func)(int))) (int);
void (*signalfnsm(int _sig, void (*func)(int))) (int);
void (*signalsnsm(int _sig, void (*func)(int))) (int);
void (*signalcbnsm(int _sig, void (*func)(int))) (int);
void (*signalssnsm(int _sig, void (*func)(int))) (int);

void (*interrupt(int _sig, void (*func)(int))) (int);
void (*interruptf(int _sig, void (*func)(int))) (int);
void (*interrupts(int _sig, void (*func)(int))) (int);
void (*interruptcb(int _sig, void (*func)(int))) (int);
void (*interruptss(int _sig, void (*func)(int))) (int);

void (*interruptnsm(int _sig, void (*func)(int))) (int);
void (*interruptfnsm(int _sig, void (*func)(int))) (int);
void (*interruptsnsm(int _sig, void (*func)(int))) (int);
void (*interruptcbnsm(int _sig, void (*func)(int))) (int);
void (*interruptssnsm(int _sig, void (*func)(int))) (int);

int raise(int);
int raisensm(int);

int clear_interrupt(int _sig);







# 13 "tt.h"











#pragma optimize_off
extern void InitPLL(void);
extern void process(void);

extern void InitDAI(void);
extern void DAIsigInit(void);
extern void setDAIproc(void);
extern void clrDAIproc(void);

extern float conv_asm( float * coef, float * inCur, float * inBase, unsigned int bufSize);	

extern void Init1835viaSPI(void);

extern void InitSPORT(void);
extern void receive(int);
extern void ClearSPORT(void);

extern void SetupSPI1835 () ;
extern void DisableSPI1835 () ;
extern void Configure1835Register (int i) ;
extern unsigned int Get1835Register (int i) ;
extern void Init1835viaSPI_PowerDwn();

extern void SetupIRQ12 () ;
extern void Irq1ISR (int i) ;
extern void Irq2ISR (int i) ;

extern void Delay (int i) ;


extern int isProcessing;
extern int dataReady;



extern unsigned int Block_A[2] ;
extern unsigned int Block_B[2] ;
extern unsigned int Block_C[2] ;


extern float rightIn  , leftIn;
extern float rightOut1, leftOut1;
extern float rightOut2, leftOut2;
extern float rightOut3, leftOut3;
extern float rightOut4, leftOut4;

extern int rightIn_i  , leftIn_i;
extern int rightOut1_i, leftOut1_i;
extern int rightOut2_i, leftOut2_i;
extern int rightOut3_i, leftOut3_i;
extern int rightOut4_i, leftOut4_i;






# 2 "process.c"
# 1 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"






 

#pragma once

#pragma system_header /* stdlib.h */





# 24 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"












  typedef long unsigned int size_t;




  typedef int wchar_t;



typedef struct {int quot; int rem;} div_t;
typedef struct {long int quot; long int rem;} ldiv_t;





  div_t  div(int _numer, int _denom);
  ldiv_t ldiv(long _numer, long _denom);





# 67 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"









 




  int __atoiD(const char __dm *_a);
  int __atoiP(const char __pm *_a);

  long __atolD(const char __dm *_a);
  long __atolP(const char __pm *_a);

  long __strtolDD(const char __dm *_a, char __dm **_b, int _base);
  long __strtolDP(const char __dm *_a, char __pm **_b, int _base);
  long __strtolPD(const char __pm *_a, char __dm **_b, int _base);
  long __strtolPP(const char __pm *_a, char __pm **_b, int _base);

  unsigned long __strtoulDD(const char __dm *a, char __dm **b, int _base);
  unsigned long __strtoulDP(const char __dm *a, char __pm **b, int _base);
  unsigned long __strtoulPD(const char __pm *a, char __dm **b, int _base);
  unsigned long __strtoulPP(const char __pm *a, char __pm **b, int _base);

# 172 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"

  int atoi(const char *a);


  long atol(const char *a);


  long strtol(const char *a, char **b, int _base);


  unsigned long strtoul(const char *a, char **b, int _base);














 




  float __atoffD(const char __dm *_bptr);
  float __atoffP(const char __pm *_bptr);

  long double __atofD(const char __dm *_bptr);
  long double __atofP(const char __pm *_bptr);

_Pragma(""linkage_name ___atofD")            _Pragma("linkage_name ___atofD")
  long double atold(const char *_bptr);

  float __strtodfDD(const char __dm *_nptr, char __dm **_endptr);
  float __strtodfDP(const char __dm *_nptr, char __pm **_endptr);
  float __strtodfPD(const char __pm *_nptr, char __dm **_endptr);
  float __strtodfPP(const char __pm *_nptr, char __pm **_endptr);

  long double __strtodDD(const char __dm *_nptr, char __dm **_endptr);
  long double __strtodDP(const char __dm *_nptr, char __pm **_endptr);
  long double __strtodPD(const char __pm *_nptr, char __dm **_endptr);
  long double __strtodPP(const char __pm *_nptr, char __pm **_endptr);

_Pragma(""linkage_name ___strtodDD")            _Pragma("linkage_name ___strtodDD")
  long double strtold(const char *_nptr, char **_endptr);


# 297 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"


  double atof(const char *_bptr);

  double strtod(const char *_nptr, char **_endptr);







# 316 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"







 




  int  abs(int _j);
  int  avg(int _a, int _b);
  int  max(int _a, int _b);
  int  min(int _a, int _b);
  int  clip(int _a, int _b);

  long labs(long _j);
  long lavg(long _a, long _b);
  long lmax(long _a, long _b);
  long lmin(long _a, long _b);
  long lclip(long _a, long _b);

# 349 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"

# 364 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"

# 408 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"








 




  int    rand(void);
  void   srand(unsigned int _seed);

  void  *calloc(size_t _nmemb, size_t _size);
  void  *malloc(size_t _size);
  void  *realloc(void *_prt, size_t _size);
  void   free(void *_ptr);

#pragma noreturn
  void   abort(void);
#pragma noreturn
_Pragma(""linkage_name __exit")
_Pragma("linkage_name __exit")

  void   exit(int _status);

  char  *getenv(const char *_name);
  int    system(const char *_string);


  typedef void _t_atexit_fp(void);
  typedef int _t_compare_fp(const void *, const void *);

  int   atexit(_t_atexit_fp);

  void *bsearch(const void*, const void*, size_t, size_t, _t_compare_fp);
  void  qsort(void*, size_t, size_t, _t_compare_fp);

# 474 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"







 




  int    _heap_lookup_name(char * _heap_name);
  void  *_heap_calloc(int _heap_index, size_t _nmemb, size_t _size);
  void   _heap_free(int _heap_index, void *_ptr);
  void  *_heap_malloc(int _heap_index, size_t _size);
  void  *_heap_realloc(int _heap_index, void *_prt, size_t _size);
  int    _heap_install(void *base, size_t length, int userid, int pmdm  );


  int    _heap_switch(int _heap_index);
  int    set_alloc_type(char * _heap_name);






# 508 "C:\\Program Files\\Analog Devices\\VisualDSP 4.5\\213xx\\include\\stdlib.h"











 




  int count_ones(int x);
  
_Pragma(""linkage_name _count_ones")                   _Pragma("linkage_name _count_ones")
  int lcount_ones(long x);








# 3 "process.c"














#pragma align 4
float __dm input1R[(100)+1];
#pragma align 4
float __dm input1L[(100)+1];

#pragma align 4
float __dm input2R[(100)+1];
#pragma align 4
float __dm input2L[(100)+1];

#pragma align 4
float __dm input3R[(100)+1];
#pragma align 4
float __dm input3L[(100)+1];

#pragma align 4
float __dm input1R2[(100)+1];

#pragma align 4
float __dm input2R2[(100)+1];



#pragma align 4
float __dm inputR[(51)+1];
#pragma align 4
float __dm inputL[(51)+1];
#pragma align 4
float __dm noiseN[(51)+1];



#pragma optimize_for_speed
int i1 = 0;
int i2 = 0;
int i3 = 0;
int j;
int k;
int k_input;
int ix;
float out_1;
float out_2;

int l;

int m1 = 0;
int m2 = 0;
int m3 = 0;
int i_dec = 0;
float out_test1;
float out_test2;


int fxlmsFlag = 0;
int identFlag = 0;
int ident3Flag = 0;
int resetFlag = 1;

int delayCtnrLimit = 2500;
int delayCtnr=0;
int delayCtnr2=0;
int delayCtnr3=0;
int delayCtnr4=0;
int delayCtnr5=0;
int delayCtnrIdnet=0;
int delayCtnrIdnetLimit=500000;	

int flagTest(int mask);
int readDAIpin(int mask);
void handle_LED(int led_value);
int led_value=0;


#pragma align 4
float __pm coefs_dec[(51)] = {
# 1 "coef_dec.dat"
-0.006579,
-0.031742,
-0.003571,
-0.007183,
-0.001919,
0.003048,
0.008524,
0.012936,
0.015159,
0.014323,
0.010030,
0.002579,
-0.006996,
-0.016932,
-0.025134,
-0.029380,
-0.027762,
-0.018990,
-0.002863,
0.019784,
0.047029,
0.075994,
0.103406,
0.125901,
0.140676,
0.145830,
0.140676,
0.125901,
0.103406,
0.075994,
0.047029,
0.019784,
-0.002863,
-0.018990,
-0.027762,
-0.029380,
-0.025134,
-0.016932,
-0.006996,
0.002579,
0.010030,
0.014323,
0.015159,
0.012936,
0.008524,
0.003048,
-0.001919,
-0.007183,
-0.003571,
-0.031742,
-0.006579,
# 93 "process.c"
	};  
float __dm inRdata;
float __dm inLdata;
float __dm inNoise;
float inNoiseArray1[(100)];
float inNoiseArray3[(100)];

float coefs_filter_1 [(100)] 

 ;   
float un1 [(100)];
float mu1 = 0.0001;		
float yn1 =0;
float err1 = 0;

float coefs_filter_2 [(100)]; 
float un2 [(100)];
float mu2 = 0.2;		
float mu2def = 0.2;				
									
									
									
									
float yn2 =0;
float err2 = 0;
float inputRfil_n = 0;
float inputRfil[(100)+1];

float coefs_filter_3 [(100)]

 ;
float mu3 = 0.0001;		
float yn3 =0;
float err3 = 0;
float yfila3=0;
float yn2array [(100)+1];
	
float noise1[(100)+1];
float noise2[(100)+1];
float noise3[(100)+1];
float noise_n;
float noise[2000];
int noiseFlag = 0;

float RightInPrev=0;
float alpha=0.00001;

void process(void)
{
    
    
    isProcessing = 1;

    
    setDAIproc();    

	

	







	if(readDAIpin(1<<19)>0){		
	    led_value |= 1 << 3;
	} else{
	    led_value &= ~(1 << 3);
	}
	

	if(readDAIpin(1<<18)>0){		
	    led_value |= 1 << 2 ;
	} else{
	    led_value &= ~(1 << 2);
	}


	if(flagTest((0x00000010))!=0){			
	    led_value |= 1 << 1;
	} else{
	    led_value &= ~(1 << 1);
	}


	if(flagTest((0x00000004))!=0){			
	    led_value |= 1 << 0;
	} else{
	    led_value &= ~(1 << 0);
	}
	
	
	if(flagTest((0x00000010))!=0)	{delayCtnr++;}		
	if(flagTest((0x00000004))!=0)	{delayCtnr2++;}		
	if(readDAIpin(1<<19)>0 && readDAIpin(1<<18)>0)	{delayCtnr3++;}		
	if(readDAIpin(1<<19)>0)	{delayCtnr4++;}		
	if(readDAIpin(1<<18)>0)	{delayCtnr5++;}		
	
	
	
	if(!(flagTest((0x00000010))!=0) && delayCtnr >= delayCtnrLimit){			
	   	delayCtnr =0;
		if(fxlmsFlag == 0){fxlmsFlag = 1;}
	   	else {fxlmsFlag = 0;}
	}
	
	
	if(!(flagTest((0x00000004))!=0) && delayCtnr2 >= delayCtnrLimit){			
	   	delayCtnr2 =0;
		if(identFlag == 0){identFlag = 1;}
	   	else {identFlag = 0;}
	}
	
	
	
	if(readDAIpin(1<<18)>0 && resetFlag == 1){		
	    fxlmsFlag = 0;
	    mu2 = mu2def;
	    inputRfil_n = 0;
	    yfila3 = 0;
	    err2 = 0;
	    for(k=0; k<(100);k++){
	    	coefs_filter_2[k] = 0;
	    }
	   	for(k=0; k<((100)+1);k++){
	    	input1R2[k] = 0;
	    	inNoiseArray1[k] = 0;
	    }
	    
	    for(k=0; k<((100)+1);k++){
	    	input2R2[k] = 0;
	    	inputRfil[k] = 0;
	    }
	    
	    for(k=0; k<((100)+1);k++){
	    	yn2array[k] = 0;
	    	inNoiseArray3[k] = 0;
	    }
	}
	
	
	if(!(readDAIpin(1<<19)>0) && !(readDAIpin(1<<18)>0) && delayCtnr3 >= delayCtnrLimit){			
	   	delayCtnr3 =0;
		if(resetFlag == 1){resetFlag = 0;}
	   	else {resetFlag = 1;}
	}
	
	
	if(resetFlag == 0 && !(readDAIpin(1<<19)>0) && delayCtnr4 >= delayCtnrLimit){			
	   	delayCtnr4 =0;
		mu2 = mu2*2;
	}
	
	
	if(resetFlag == 0 && !(readDAIpin(1<<18)>0) && delayCtnr5 >= delayCtnrLimit){			
	   	delayCtnr5 =0;
		mu2 = mu2/2;
	}
	
	
	
	if(resetFlag == 1){			
	    led_value |= 1 << 4;
	    led_value |= 1 << 5;
	    led_value |= 1 << 6;
	    led_value |= 1 << 7;
	} 
	else{
	    led_value &= ~(1 << 4);
	    led_value &= ~(1 << 5);
	    led_value &= ~(1 << 6);
	    led_value &= ~(1 << 7);
	}
	
	
	if(identFlag == 1){			
	    led_value |= 1 << 0;
	} 
	else{
	    led_value &= ~(1 << 0);
	}
	
	
	if(fxlmsFlag == 1){			
	    led_value |= 1 << 1;
	} 
	else{
	    led_value &= ~(1 << 1);
	}
	
	
	if(ident3Flag == 1){			
	    led_value |= 1 << 2;
	} 
	else{
	    led_value &= ~(1 << 2);
	}
	
	
	
	l--;
	if (l<0)
	{
		l = 5;
	}
	


		if((identFlag==1) || (ident3Flag==1)){
		    
				noise_n = (float)(rand()<<1);
				noise_n = noise_n / (1<<31);
				
		    
			
		}


	


















 	
	
		i_dec--;
		if (0>i_dec)
		{
		i_dec = (51)-1;
		}
		
	
	
	
	
	
	
	rightIn = rightIn - RightInPrev;
	RightInPrev = alpha * rightIn + RightInPrev;






























 
   
   
   
   
   	inputR[i_dec] = rightIn;
   	inputL[i_dec] = leftIn;
   	noise1[i_dec] = noise_n;
	if (0==i1){
		inputR[(51)] = rightIn;  
		inputL[(51)] =  leftIn;  
		noiseN[(51)] = noise_n;
    }
    
    

	if (l==0)
	{
	    m1--;
		if (m1<0)
		{
			m1 = (100)-1;
		}
		
		m2--;
		if (m2<0)
		{
			m2 = (100)-1;
		}
		
		m3--;
		if (m3<0)
		{
			m3 = (100)-1;
		}

		
		
					
	    
	    
	    	inRdata	= conv_asm( coefs_dec, &(inputR[i_dec]), inputR, (51));
			inLdata	= conv_asm( coefs_dec, &(inputL[i_dec]), inputL, (51));
			inNoise	= conv_asm( coefs_dec, &(noiseN[i_dec]), noise1, (51));
			inNoiseArray1[m1] = inNoise;
			inNoiseArray3[m3] = inNoise;
		
	}
	out_test1 = conv_asm( coefs_dec, &(inputR[i_dec]), inputR, (51));
	


   
    
    



	



	if((identFlag == 1) && (l==0)){			
	
		yn1 = 0;
		
		
		
		
		yn1 = conv_asm( coefs_filter_1, &(inNoiseArray1[m1]), inNoiseArray1, (100));		
		err1 = inLdata - yn1;
		
		k = 0; 
		k_input = m1;
		for(k; k<((100)); k++){  
		    		    
		    
		    coefs_filter_1[k] = coefs_filter_1[k] + mu1*err1*inNoiseArray1[k_input%(100)];		    
		    k_input++;
		    
		}
		delayCtnrIdnet++;
		
		if(delayCtnrIdnet == delayCtnrIdnetLimit/6){
		    identFlag=0; 
		    delayCtnrIdnet=0;
			ident3Flag = 1;    
		}
	}
		








	if((ident3Flag == 1) && (l==0)){			

		
		yn3 = 0;
		
		
		
		
		yn3 = conv_asm( coefs_filter_3, &(inNoiseArray3[m3]), inNoiseArray3, (100));		
		err3 = inRdata - yn3;
		
		k = 0;
		k_input = m3;
		for(k; k<((100)); k++){  
		    		    
		    
		    coefs_filter_3[k] = coefs_filter_3[k] + mu3*err3*inNoiseArray3[k_input%(100)];	    	
		    k_input++;
		}
		
		delayCtnrIdnet++;
		
		if(delayCtnrIdnet == delayCtnrIdnetLimit/6){ident3Flag=0; delayCtnrIdnet=0;}
	}


	






	
	if((fxlmsFlag == 1) && (l==0)){			
	
		yn2 = 0;

		input1R2[m1] = inRdata-yfila3;
		if(m1==0){
			input1R2[(100)] = inRdata-yfila3;
		}
		
		input2R2[m2] = inRdata-yfila3;
		
		if(m2==0){
			input2R2[(100)] = inRdata-yfila3;
		}
		
		inputRfil_n = conv_asm( coefs_filter_1, &(input1R2[m1]), input1R2, (100));		
		inputRfil[m2] = inputRfil_n;		
		if(m2==0){
			inputRfil[(100)] = inputRfil_n;
		}
					
		yn2 = -(conv_asm( coefs_filter_2, &(input2R2[m2]), input2R2, (100)));		
		
		yn2array[m3] = yn2;
		if(m3==0){
			yn2array[(100)] = yn2;
		}

		yfila3 = conv_asm( coefs_filter_3, &(yn2array[m3]), yn2array, (100));				
				
		
		err2 = inLdata;
		k = 0;
		k_input = m2;
		for(k; k<(100); k++){
		
		    coefs_filter_2[k] = coefs_filter_2[k] + mu2*err2*inputRfil[k_input%(100)];		
			k_input++;
		}	

	}






if(l==0)
{	
	if(identFlag == 1){			
		
		out_1 = inNoiseArray1[m1];
	}
}

	if(fxlmsFlag == 1){			
	    out_1 = yn2;
	}
if(l==0)	
	if(ident3Flag == 1){			
	    
	    out_1 = inNoiseArray3[m3];
	}

	




	


	rightOut1 = out_1;  
	 leftOut1 = inRdata;	
	 
	rightOut2 = err1; 		
	 leftOut2 = out_test1;	
	 
	rightOut3 = err3;
	 leftOut3 = err3;
	 


       

	
    clrDAIproc();    
	handle_LED(led_value);
	
      
    isProcessing = 0;
}

int flagTest(int mask){
        int tmpANC0;

        asm volatile(
                " %0 = flags;\n\t"
                : "=&d" (tmpANC0)
                :
                :
                );
return (   (tmpANC0&mask)    );

}



int readDAIpin(int mask){
int tmpR;

 	asm volatile(
 	     		"%0 = flags;\n\t"
 	     		: "=&F" (tmpR)
 	     		:
 	     		:
 	     		);

 	tmpR &= (0x10000000);
 	
     return ((*((volatile unsigned int *) 0x24B9))&mask);

}




void handle_LED(int led_value){
    *((volatile unsigned int *) 0x1800)=0;

    *((volatile unsigned int *) 0x1818)=(int)&led_value;  
    *((volatile unsigned int *) 0x1819)=1;
    *((volatile unsigned int *) 0x181a)=1;
    *((volatile unsigned int *) 0x1811)=1;
    *((volatile unsigned int *) 0x1812)=1;
    *((volatile unsigned int *) 0x1810)=0x400000;   

    *((volatile unsigned int *) 0x1800)=(0x00000200)|(0x00000040)|(0x00000002|0x00000004|0x00000020)|(0x00000100)|(0x00000001);
}


