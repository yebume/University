%% Clean up
clear;
clc;
close all;

%% Sampling freqency
fs = 44100;

%% Frequency scale
N = 32768;
N_4k = 2972;
f = 0 : fs/N : fs-(fs/N);
f_4k = 0 : 4000/N_4k : 4000-(4000/N_4k);

d = 1652;
ti = 8888*2;

pos_short = 0.42;
pos_long = 0.55;

%% M1- xLMS, eLMS, exLMS 
% xLMS
M1_x_sin400_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1_xLMS\xLMS_sin400hz_mu0.0005.wav').data;
M1_x_WN1500_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1_xLMS\xLMS_whitenoise1.5khz_mu0.00005.wav').data;

figure(1);
    start = 435737+6041-d;
    stop = start+ti;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_x_sin400_err(start:stop));
    hold on;
    s_rms = getRMS(M1_x_sin400_err(start:stop), 100);
    plot(t, s_rms);
    [t_settle, suppression, debug_rms, dbg_count] = getSettleTime(M1_x_sin400_err(60000:end), 4000, fs);
    title('xLMS hibajele - szinuszos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    s1_f = 20*log10(abs(fft(M1_x_sin400_err(60000:60000+100000),N)));
    s2_f = 20*log10(abs(fft(M1_x_sin400_err(600000:600000+100000),N)));
    suppression = s2_f(298)-s1_f(298);
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.0005" + newline + "Beállási idő: "+ t_settle + " ms" + newline + "Elnyomás: " + -suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény', 'rms');

figure(201);
    title('xLMS hibajele - szinuszos gerjesztésre ZOOM');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (333)/fs;
    s1 = M1_x_sin400_err(60000:60000+333);
    s2 = M1_x_sin400_err(600000:600000+333);
    plot(t, s1);
    plot(t, s2);
    legend('ANC off','ANC on');
figure(301);
    title('xLMS spektruma - szinuszos gerjesztésre');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(M1_x_sin400_err(60000:60000+100000),N)));
    s2_f = 20*log10(abs(fft(M1_x_sin400_err(600000:600000+100000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    % 400 Hz -> 298
    suppression = s2_f(298)-s1_f(298);
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + -suppression + " dB", 'BackgroundColor', 'w');
    
figure(401)
    hold on;
    plot(M1_x_sin400_err(60000:end));
    plot(debug_rms);
    plot(dbg_count);

figure(2);
    start = 1;
    stop = start + 2646000;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_x_WN1500_err(start:stop));
    hold on;
    s_rms = getRMS(M1_x_WN1500_err(start:stop), 10000);
    plot(t, s_rms);
    [t_settle, suppression, debug_rms, dbg_count] = getSettleTime(M1_x_WN1500_err, 20000, fs);
    title('xLMS hibajele - fehérzajos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    s1 = M1_x_WN1500_err(1:1+400000);
    s2 = M1_x_WN1500_err(4E6:4E6+400000);
    suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "bw: 1.5 kHz" + newline + "Bátorsági tényező: 0.00005" + newline + "Beállási idő: "+ t_settle/1000 + " s" + newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény', 'rms');
figure(202);
    title('xLMS hibajele - fehérzajos gerjesztésre ZOOM');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (400000)/fs;
    s1 = M1_x_WN1500_err(1:1+400000);
    s2 = M1_x_WN1500_err(4E6:4E6+400000);
    plot(t, s1);
    plot(t, s2);
    legend('ANC off','ANC on');
figure(302);
    title('xLMS spektruma - fehérzajos gerjesztésre');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(M1_x_WN1500_err(1:1+400000),N)));
    s2_f = 20*log10(abs(fft(M1_x_WN1500_err(4E6:4E6+400000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    % 400 Hz -> 298
    suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');

figure(402)
    hold on;
    plot(M1_x_WN1500_err);
    plot(debug_rms);
    plot(dbg_count);

% eLMS
M1_e_sin400_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1_eLMS\eLMS_sin400hz_mu0.00003.wav').data;
M1_e_WN1500_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1_eLMS\eLMS_whitenoise1.5khz_mu0.00003.wav').data;

figure(3);
    start = 520805+531-d;
    stop = start+ti;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_e_sin400_err(start:stop));
    hold on;
    s_rms = getRMS(M1_e_sin400_err(start:stop), 100);
    plot(t, s_rms);
    [t_settle, suppression, debug_rms, dbg_count] = getSettleTime(M1_e_sin400_err(start:stop), 10000, fs);
    title('eLMS hibajele - szinuszos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    s1_f = 20*log10(abs(fft(M1_x_sin400_err(200000:200000+100000),N)));
    s2_f = 20*log10(abs(fft(M1_x_sin400_err(600000:600000+100000),N)));
    suppression = s2_f(298)-s1_f(298);
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.0003" + newline + "Beállási idő: "+ t_settle + " ms"+ newline + "Elnyomás: " + -suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény', 'rms');
figure(203);
    title('eLMS hibajele - szinuszos gerjesztésre ZOOM');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (333)/fs;
    s1 = M1_e_sin400_err(200000:200000+333);
    s2 = M1_e_sin400_err(600000:600000+333);
    plot(t, s1);
    plot(t, s2);
    legend('ANC off','ANC on');
figure(303);
    title('eLMS spektruma - szinuszos gerjesztésre');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(M1_x_sin400_err(200000:200000+100000),N)));
    s2_f = 20*log10(abs(fft(M1_x_sin400_err(600000:600000+100000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    suppression = s2_f(298)-s1_f(298);
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + -suppression + " dB", 'BackgroundColor', 'w');
figure(403)
    hold on;
    plot(M1_e_sin400_err(100000:end));
    plot(debug_rms);
    plot(dbg_count);

figure(4);
    start = 1;
    stop = start + 2646000;
    %stop = length(M1_e_WN1500_err);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_e_WN1500_err(start:stop));
    hold on;
    s_rms = getRMS(M1_e_WN1500_err(start:stop), 10000);
    plot(t, s_rms);
    [t_settle, suppression, debug_rms, dbg_count] = getSettleTime(M1_e_WN1500_err(start:stop), 40000, fs);
    title('eLMS hibajele - fehérzajos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    s1 = M1_e_WN1500_err(1:1+400000);
    s2 = M1_e_WN1500_err(1E6:1E6+400000);
    suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "bw: 1.5 kHz" + newline + "Bátorsági tényező: 0.00005" + newline + "Beállási idő: "+ t_settle/1000 + " s" + newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény', 'rms');
figure(204);
    title('eLMS hibajele - fehérzajos gerjesztésre ZOOM');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (400000)/fs;
    s1 = M1_e_WN1500_err(1:1+400000);
    s2 = M1_e_WN1500_err(1E6:1E6+400000);
    plot(t, s1);
    plot(t, s2);
    legend('ANC off','ANC on');
figure(304);
    title('eLMS spektruma - fehérzajos gerjesztésre');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(M1_e_WN1500_err(1:1+400000),N)));
    s2_f = 20*log10(abs(fft(M1_e_WN1500_err(1E6:1E6+400000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    % 400 Hz -> 298
    suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
figure(404)
    hold on;
    plot(M1_e_WN1500_err);
    plot(debug_rms);
    plot(dbg_count);

% exLMS
M1_ex_sin400_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1_exLMS\exLMS_sin400hz_mu0.0001.wav').data;
M1_ex_WN1500_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1_exLMS\exLMS_whitenoise1.5khz_mu0.00001.wav').data;

figure(5);
    start = 437183+4753-d;
    stop = start+ti;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_ex_sin400_err(start:stop));
    hold on;
    s_rms = getRMS(M1_ex_sin400_err(start:stop), 100);
    plot(t, s_rms);
    [t_settle, suppression, debug_rms, dbg_count] = getSettleTime(M1_ex_sin400_err(start:stop), 4000, fs);
    %plot(debug_rms);
    %hold on;
    %plot(dbg_count);
    title('exLMS hibajele - szinuszos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    s1_f = 20*log10(abs(fft(M1_ex_sin400_err(200000:200000+100000),N)));
    s2_f = 20*log10(abs(fft(M1_ex_sin400_err(600000:600000+100000),N)));
    suppression = s2_f(298)-s1_f(298);
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.0001" + newline + "Beállási idő: "+ t_settle + " ms"+ newline + "Elnyomás: " + -suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény', 'rms');
figure(205);
    title('exLMS hibajele - szinuszos gerjesztésre ZOOM');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (333)/fs;
    s1 = M1_ex_sin400_err(200000:200000+333);
    s2 = M1_ex_sin400_err(600000:600000+333);
    plot(t, s1);
    plot(t, s2);
    legend('ANC off','ANC on');
figure(305);
    title('exLMS spektruma - szinuszos gerjesztésre');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(M1_ex_sin400_err(200000:200000+100000),N)));
    s2_f = 20*log10(abs(fft(M1_ex_sin400_err(600000:600000+100000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    suppression = s2_f(298)-s1_f(298);
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + -suppression + " dB", 'BackgroundColor', 'w');
figure(405)
    hold on;
    plot(M1_ex_sin400_err);
    plot(debug_rms);
    plot(dbg_count);

figure(6);
    start = 1;
    %stop = length(M1_ex_WN1500_err);
    stop = start + 2646000;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_ex_WN1500_err(start:stop));
    hold on;
    s_rms = getRMS(M1_ex_WN1500_err(start:stop), 10000);
    plot(t, s_rms);
    [t_settle, suppression, debug_rms, dbg_count] = getSettleTime(M1_ex_WN1500_err, 20000, fs);
    title('exLMS hibajele - fehérzajos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    s1 = M1_ex_WN1500_err(1:1+400000);
    s2 = M1_ex_WN1500_err(2E6:2E6+400000);
    suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "bw: 1.5 kHz" + newline + "Bátorsági tényező: 0.00001" + newline + "Beállási idő: "+ t_settle/1000 + " s" + newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény', 'rms');
figure(206);
    title('exLMS hibajele - fehérzajos gerjesztésre ZOOM');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (400000)/fs;
    s1 = M1_ex_WN1500_err(1:1+400000);
    s2 = M1_ex_WN1500_err(2E6:2E6+400000);
    plot(t, s1);
    plot(t, s2);
    legend('ANC off','ANC on');
figure(306);
    title('exLMS spektruma - fehérzajos gerjesztésre');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(M1_ex_WN1500_err(1:1+400000),N)));
    s2_f = 20*log10(abs(fft(M1_ex_WN1500_err(2E6:2E6+400000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    % 400 Hz -> 298
    suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
figure(406)
    hold on;
    plot(M1_ex_WN1500_err);
    plot(debug_rms);
    plot(dbg_count);

%% M1, M2, M3
% M1
M1_sin400_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1\M1_sin400_err.wav').data;
figure(7);
    title('M1 - Szinusz elnyomása');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    N = 32768;
    s1_f = 20*log10(abs(fft(M1_sin400_err(1:160000),N)));
    s2_f = 20*log10(abs(fft(M1_sin400_err(300000:300000+160000),N)));
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    legend('ANC off','ANC on');
    suppression = s1_f(298) - s2_f(298);
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
figure(8);
    start = 184301-d;
    stop = start+ti;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_sin400_err(start:stop));
    hold on;
    s_rms = getRMS(M1_sin400_err(start:stop), 100);
    plot(t, s_rms);
    [t_settle, ~, debug_rms, dbg_count] = getSettleTime(M1_sin400_err, 4000, fs);
    title('M1 - eLMS hibajele - szinusz gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.00003" + newline + "Beállási idő: "+ t_settle + " ms"+ newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény','rms');

figure(408)
    hold on;
    plot(M1_sin400_err);
    plot(debug_rms);
    plot(dbg_count);

M1_WN1500_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1\M1_WN1.5k_err.wav').data;
figure(9);
    title('M1 - Fehérzaj elnyomása');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(M1_WN1500_err(1:160000),N)));
    s2_f = 20*log10(abs(fft(M1_WN1500_err(800000:800000+160000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    s1 = M1_WN1500_err(1:160000);
    s2 = M1_WN1500_err(800000:800000+160000);
	suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
	

figure(10);
    start = 1;
    stop = start + 882000;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M1_WN1500_err(start:stop));
    hold on;
    s_rms = getRMS(M1_WN1500_err(start:stop), 10000);
    plot(t, s_rms);
    [t_settle, ~, debug_rms, dbg_count] = getSettleTime(M1_WN1500_err, 20000, fs);
    title('M1 - eLMS hibajele - fehérzajos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.00003" + newline + "Beállási idő: "+ t_settle/1000 + " s"+ newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény','rms');

figure(410)
    hold on;
    plot(M1_WN1500_err);
    plot(debug_rms);
    plot(dbg_count);

    

% M2
M2_sin400_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M2\M2_sin400_err.wav').data;
figure(11);
    title('M2 - sin elnyomása');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(M2_sin400_err(1:40000),N)));
    s2_f = 20*log10(abs(fft(M2_sin400_err(200000:200000+40000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    suppression = s1_f(298) - s2_f(298);
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
	
figure(12);
    start = 175400+1000-d;
    stop = start+ti;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M2_sin400_err(start:stop));
    hold on;
    s_rms = getRMS(M2_sin400_err(start:stop), 100);
    plot(t, s_rms);
    [t_settle, ~, debug_rms, dbg_count] = getSettleTime(M2_sin400_err, 4000, fs);
    title('M2 - eLMS hibajele - szinuszos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.00003" + newline + "Beállási idő: "+ t_settle + " ms"+ newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény','rms');

figure(412)
    hold on;
    plot(M2_sin400_err);
    plot(debug_rms);
    plot(dbg_count);

M2_WN1500_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M2\M2_WN1.5k_err.wav').data;
figure(13);
    title('M2 - Fehérzaj elnyomása');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(M2_WN1500_err(1:160000),N)));
    s2_f = 20*log10(abs(fft(M2_WN1500_err(500000:500000+160000),N)));
    plot(f_4k, s1_f(1:N_4k));
    plot(f_4k, s2_f(1:N_4k));
    legend('ANC off','ANC on');
    s1 = M1_WN1500_err(1:160000);
    s2 = M1_WN1500_err(500000:500000+160000);
	suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
	
	
figure(14);
    start = 1;
    stop = start + 882000;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M2_WN1500_err(start:stop));
    hold on;
    s_rms = getRMS(M2_WN1500_err(start:stop), 10000);
    plot(t, s_rms);
    [t_settle,  ~, debug_rms, dbg_count] = getSettleTime(M2_WN1500_err, 20000, fs);
    title('M2 - eLMS hibajele - fehérzajos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.00003" + newline + "Beállási idő: "+ t_settle/1000 + " s"+ newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény','rms');

figure(414)
    hold on;
    plot(M2_WN1500_err);
    plot(debug_rms);
    plot(dbg_count);


% M3
M3_sin400_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M3\M3_w_sin400_err.wav').data;
figure(15);
    title('M3 - sin elnyomása');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(M3_sin400_err(1:140000),N)));
    s2_f = 20*log10(abs(fft(M3_sin400_err(200000:200000+140000),N)));
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    legend('ANC off','ANC on');
    suppression = s1_f(298) - s2_f(298);
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
	
figure(16);
    start = 175000+2056-d;
    stop = start+ti;
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M3_sin400_err(start:stop));
    hold on;
    s_rms = getRMS(M3_sin400_err(start:stop), 100);
    plot(t, s_rms);
    [t_settle, ~, debug_rms, dbg_count] = getSettleTime(M3_sin400_err, 8000, fs);
    title('M3 - eLMS hibajele - szinuszos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.00003" + newline + "Beállási idő: "+ t_settle + " ms"+ newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény','rms');

figure(416)
    hold on;
    plot(M3_sin400_err);
    plot(debug_rms);
    plot(dbg_count);

M3_WN1500_err = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M3\M3_w_WN1.5k_err.wav').data;
figure(17);
    title('M3 - Fehérzaj elnyomása');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(M3_WN1500_err(1:130000),N)));
    s2_f = 20*log10(abs(fft(M3_WN1500_err(600000:600000+130000),N)));
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    legend('ANC off','ANC on');
    s1 = M1_WN1500_err(1:130000);
    s2 = M1_WN1500_err(600000:600000+130000);
	suppression = 20*log10(rms(s1)/rms(s2));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
figure(18);
    start = 1;
    stop = length(M3_WN1500_err);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t,M3_WN1500_err(start:stop));
    hold on;
    s_rms = getRMS(M3_WN1500_err(start:stop), 10000);
    plot(t, s_rms);
    [t_settle, ~, debug_rms, dbg_count] = getSettleTime(M3_WN1500_err, 40000, fs);
    title('M3 - eLMS hibajele - fehérzajos gerjesztésre');
    grid on;
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    annotation('textbox', [pos_long, 0.8, 0.1, 0.1], 'String', "f: 400 Hz" + newline + "Bátorsági tényező: 0.00003" + newline + "Beállási idő: "+ t_settle/1000 + " s"+ newline + "Elnyomás: " + suppression + " dB", 'BackgroundColor', 'w');
    legend('Időfüggvény','rms');
    
figure(418)
    hold on;
    plot(M3_WN1500_err);
    plot(debug_rms);
    plot(dbg_count);


%% Sound effects
% Big bell
NoTeach_Bigbell = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Big Bell\NoTeach_Bigbell.wav').data;
figure(19);
    start = 1;
    stop = length(NoTeach_Bigbell);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, NoTeach_Bigbell);
    title('Harang időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(20);
    spectrogram(NoTeach_Bigbell,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(21);
    s = NoTeach_Bigbell(149238:149238 +128000);
    s_red = NoTeach_Bigbell(1437370:1437370 +128000);
    title('Harang spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = NoTeach_Bigbell(21217:21217+78783);
    s_red = NoTeach_Bigbell(1695520:1695520+78783);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(22);
    title('Harang időfüggvénye zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = NoTeach_Bigbell(21217:21217+78783);
    s_red = NoTeach_Bigbell(1695520:1695520+78783);
    t = 0 : 1/fs : (78783)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');


NoTeach_Bigbell_10minbreak = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Big Bell\NoTeach_Bigbell_10minbreak.wav').data;
figure(23);
    start = 1;
    stop = length(NoTeach_Bigbell_10minbreak);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, NoTeach_Bigbell_10minbreak);
    title('Harang időfüggvénye 10 perc szünet után');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(24);
    spectrogram(NoTeach_Bigbell_10minbreak,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(25);
    s = NoTeach_Bigbell_10minbreak(133633:133633 +128000);
    s_red = NoTeach_Bigbell_10minbreak(1550610:1550610 +128000);
    title('Harang spektruma 10 perc szünet után');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = NoTeach_Bigbell_10minbreak(134453:134453+78783);
    s_red = NoTeach_Bigbell_10minbreak(1552430:1552430+78783);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');

figure(26);
    title('Harang időfüggvénye 10 perc szünet után zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = NoTeach_Bigbell_10minbreak(134453:134453+78783);
    s_red = NoTeach_Bigbell_10minbreak(1552430:1552430+78783);
    t = 0 : 1/fs : (78783)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');


Teach_Bigbell = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Big Bell\Teach_Bigbell.wav').data;
figure(27);
    start = 1;
    stop = length(Teach_Bigbell);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, Teach_Bigbell);
    title('Harang időfüggvénye (tanítva)');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(28);
    spectrogram(Teach_Bigbell,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 30]);
figure(29);
    s = Teach_Bigbell(271000:271000 +128000);
    s_red = Teach_Bigbell(786226:786226 +128000);
    title('Harang spektruma (tanítva)');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = Teach_Bigbell(142545:142545+78783);
    s_red = Teach_Bigbell(1044460:1044460+78783);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(30);
    title('Harang időfüggvénye (tanítva) zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = Teach_Bigbell(142545:142545+78783);
    s_red = Teach_Bigbell(1044460:1044460+78783);
    t = 0 : 1/fs : (78783)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

Teach_Bigbell_10minbreak = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Big Bell\Teach_Bigbell_10minbreak.wav').data;
figure(31);
    start = 1;
    stop = length(Teach_Bigbell_10minbreak);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, Teach_Bigbell_10minbreak);
    title('Harang időfüggvénye (tanítva) 10 perc szünet után');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(32);
    spectrogram(Teach_Bigbell_10minbreak,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 30]);
figure(33);
    s = Teach_Bigbell_10minbreak(161853:161853 +128000);
    s_red =Teach_Bigbell_10minbreak(1192390:1192390 +128000);
    title('Harang spektruma (tanítva) 10 perc szünet után');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = Teach_Bigbell_10minbreak(163538:163538+78783);
    s_red = Teach_Bigbell_10minbreak(1192980:1192980+78783);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(34);
    title('Harang időfüggvénye (tanítva) 10 perc szünet után zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = Teach_Bigbell_10minbreak(163538:163538+78783);
    s_red = Teach_Bigbell_10minbreak(1192980:1192980+78783);
    t = 0 : 1/fs : (78783)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');


% Door bell
NoTeach_DoorBell = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Door Bell\NoTeach_DoorBell.wav').data;
figure(35);
    start = 1;
    stop = length(NoTeach_DoorBell);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, NoTeach_DoorBell);
    title('Csengő időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(36);
    spectrogram(NoTeach_DoorBell,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(37);
    s = NoTeach_DoorBell(1063490:1063490 +132344);
    s_red = NoTeach_DoorBell(931158:931158 +132344);
    title('Csengő spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = NoTeach_DoorBell(269976:269976+75145);
    s_red = NoTeach_DoorBell(799085:799085+75145);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(38);
    title('Csengő időfüggvénye zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = NoTeach_DoorBell(269976:269976+75145);
    s_red = NoTeach_DoorBell(799085:799085+75145);
    t = 0 : 1/fs : (75145)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');


NoTeach_DoorBell_10minbreak = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Door Bell\NoTeach_DoorBell_10minBreak.wav').data;
figure(39);
    start = 1;
    stop = length(NoTeach_DoorBell_10minbreak);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, NoTeach_DoorBell_10minbreak);
    title('Csengő időfüggvénye 10 perc szünet után');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(40);
    spectrogram(NoTeach_DoorBell_10minbreak,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(41);
    s = NoTeach_DoorBell_10minbreak(289149:289149 +132344);
    s_red = NoTeach_DoorBell_10minbreak(1083210:1083210 +132344);
    title('Csengő spektruma 10 perc szünet után');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = NoTeach_DoorBell_10minbreak(289428:289428+75145);
    s_red = NoTeach_DoorBell_10minbreak(1083480:1083480+75145);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(42);
    title('Csengő időfüggvénye 10 perc szünet után zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = NoTeach_DoorBell_10minbreak(289428:289428+75145);
    s_red = NoTeach_DoorBell_10minbreak(1083480:1083480+75145);
    t = 0 : 1/fs : (75145)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

Teach_DoorBell = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Door Bell\Teach_DoorBell.wav').data;
figure(43);
    start = 1;
    stop = length(Teach_DoorBell);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, Teach_DoorBell);
    title('Csengő időfüggvénye (tanítva)');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(44);
    spectrogram(Teach_DoorBell,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(45);
    s = Teach_DoorBell(158036:158036 +132344);
    s_red = Teach_DoorBell(796651:796651 +132344);
    title('Csengő spektruma (tanítva)');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = Teach_DoorBell(158314:158314+75145);
    s_red = Teach_DoorBell(820155:820155+75145);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(46);
    title('Csengő időfüggvénye (tanítva) zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = Teach_DoorBell(158314:158314+75145);
    s_red = Teach_DoorBell(820155:820155+75145);
    t = 0 : 1/fs : (75145)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

Teach_DoorBell_10minbreak = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Door Bell\Teach_DoorBell_10minBreak.wav').data;
figure(47);
    start = 1;
    stop = length(Teach_DoorBell_10minbreak);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, Teach_DoorBell_10minbreak);
    title('Csengő időfüggvénye (tanítva) 10 perc szünet után');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(48);
    spectrogram(Teach_DoorBell_10minbreak,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(49);
    s = Teach_DoorBell_10minbreak(146221:146221 +132344);
    s_red = Teach_DoorBell_10minbreak(675594:675594 +132344);
    title('Csengő spektruma (tanítva) 10 perc szünet után');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = Teach_DoorBell_10minbreak(146620:146620+75145);
    s_red = Teach_DoorBell_10minbreak(675996:675996+75145);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(50);
    title('Csengő időfüggvénye (tanítva) 10 perc szünet után zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = Teach_DoorBell_10minbreak(146620:146620+75145);
    s_red = Teach_DoorBell_10minbreak(675996:675996+75145);
    t = 0 : 1/fs : (75145)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

% Ticking
NoTeach_Ticking = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Ticking\NoTeach_Ticking2.wav').data;
figure(51);
    start = 1;
    stop = length(NoTeach_Ticking);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, NoTeach_Ticking);
    title('Óra időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(52);
    spectrogram(NoTeach_Ticking,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(53);
    s = NoTeach_Ticking(195051:195051+44187);
    s_red = NoTeach_Ticking(1518163:1518163+44187);
    title('Óra spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = NoTeach_Ticking(195051:195051+4786);
    s_red = NoTeach_Ticking(1518163:1518163+4786);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(54);
    title('Óra időfüggvénye zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = NoTeach_Ticking(195051:195051+4786);
    s_red = NoTeach_Ticking(1518163:1518163+4786);
    t = 0 : 1/fs : (4786)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

Teach_Ticking = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Ticking\Teach_Ticking2.wav').data;
figure(55);
    start = 1;
    stop = length(Teach_Ticking);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, Teach_Ticking);
    title('Óra időfüggvénye (tanítva)');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(56);
    spectrogram(Teach_Ticking,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(57);
    s = Teach_Ticking(53589:53589 +44187);
    s_red = Teach_Ticking(1597296:1597296 +44187);
    title('Óra spektruma (tanítva)');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = Teach_Ticking(53589:53589+4786);
    s_red = Teach_Ticking(1597296:1597296+4786);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(58);
    title('Óra időfüggvénye (tanítva) zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = Teach_Ticking(53589:53589+4786);
    s_red = Teach_Ticking(1597296:1597296+4786);
    t = 0 : 1/fs : (4786)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

% Metronom
NoTeach_Metronom = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - metronóm\NoTeach_Metronom.wav').data;
figure(59);
    start = 1;
    stop = length(NoTeach_Ticking);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, NoTeach_Ticking);
    title('Metronóm időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(60);
    spectrogram(NoTeach_Metronom,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(61);
    s = NoTeach_Metronom(13611:13611 +18969);
    s_red = NoTeach_Metronom(740808:740808 +18969);
    title('Metronóm spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = NoTeach_Metronom(13611:13611+3619);
    s_red = NoTeach_Metronom(740808:740808+3619);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(62);
    title('Metronóm időfüggvénye zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = NoTeach_Metronom(13611:13611+3619);
    s_red = NoTeach_Metronom(740808:740808+3619);
    t = 0 : 1/fs : (3619)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

Teach_Metronom = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - metronóm\Teach_Metronom.wav').data;
figure(63);
    start = 1;
    stop = length(Teach_Metronom);
    t = 0 : 1/fs : (stop-start)/fs;
    plot(t, Teach_Metronom);
    title('Metronóm időfüggvénye (tanítva)');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    grid on;
figure(64);
    spectrogram(Teach_Metronom,hanning(1024),0,1024,fs);
    colormap('jet');
    xlim([0 4]);
    ylim([0 25]);
figure(65);
    s = Teach_Metronom(14043:14043 +18969);
    s_red = Teach_Metronom(828360:828360 +18969);
    title('Metronóm spektruma (tanítva)');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    grid on;
    hold on;
    s1_f = 20*log10(abs(fft(s,N)));
    s2_f = 20*log10(abs(fft(s_red,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    s = Teach_Metronom(14043:14043+3619);
    s_red = Teach_Metronom(828360:828360+3619);
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
    legend('ANC off','ANC on');
figure(66);
    title('Metronóm időfüggvénye (tanítva) zoom');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    s = Teach_Metronom(14043:14043+3619);
    s_red = Teach_Metronom(828360:828360+3619);
    t = 0 : 1/fs : (3619)/fs;
    plot(t,s);
    plot(t,s_red);
    legend('ANC off','ANC on');
    s_rms = 20*log10(rms(s_red)/rms(s));
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');

%% Musics
% Classic
classic_normal = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Beethoven-7.4\classic.wav').data;
classic_anc = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Beethoven-7.4\anc.wav').data;
    s1 = classic_normal(4069594:4069594+ 3023197);
    s2 = classic_anc(4069594-25680:4069594-25680+ 3023197);
figure(67);
    title('Klasszikus zene időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (3023197)/fs;
    plot(t, s1);
    plot(t, s2);
    s_rms = 20*log10(rms(s2)/rms(s1));
    legend('ANC off','ANC on');
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
figure(68);
    title('Klasszikus zene spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(s1,N)));
    s2_f = 20*log10(abs(fft(s2,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    legend('ANC off','ANC on');
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
% Electronic
electronic_normal = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Waterfalme - Run!\Classic4.wav').data;
electronic_anc = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Waterfalme - Run!\ANC4.wav').data;

s1 = electronic_normal(1984500:1984500+882000);
s2 = electronic_anc(1984500+17467+33955-6603:1984500+17467+33955-6603+882000);

plot(s1)
hold on
plot(s2)
hold off

figure(69);
    title('Elektronikus zene időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (882000)/fs;
    plot(t, s1);
    plot(t, s2);
    s_rms = 20*log10(rms(s2)/rms(s1));
    legend('ANC off','ANC on');
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás: " + -s_rms + " dB", 'BackgroundColor', 'w');
figure(70);
    title('Elektronikus zene spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(s1,N)));
    s2_f = 20*log10(abs(fft(s2,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    legend('ANC off','ANC on');
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás: " + -s_rms + " dB", 'BackgroundColor', 'w');
    
% Rock
rock_normal = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Mötley Crüe - Kickstart my hearth\classic.wav').data;
rock_anc = importdata('C:\Users\Yebume\Desktop\Szakdolgozat\Mérések\M1 - Mötley Crüe - Kickstart my hearth\anc.wav').data;

s1 = rock_normal(4630500:4630500+882000);
s2 = rock_anc(4630500-12709:4630500-12709+882000);

figure(71);
    title('Rock zene időfüggvénye');
    xlabel('Idő [s]');
    ylabel('Amplitúdó');
    hold on;
    grid on;
    t = 0 : 1/fs : (882000)/fs;
    plot(t, s1);
    plot(t, s2);
    s_rms = 20*log10(rms(s2)/rms(s1));
    legend('ANC off','ANC on');
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
figure(72);
    title('Rock zene spektruma');
    xlabel('Frekvencia [Hz]');
    ylabel('Amplitúdó [dB]');
    hold on;
    grid on;
    s1_f = 20*log10(abs(fft(s1,N)));
    s2_f = 20*log10(abs(fft(s2,N))); 
    plot(f_4k,s1_f(1:N_4k));
    plot(f_4k,s2_f(1:N_4k));
    legend('ANC off','ANC on');
    annotation('textbox', [pos_short, 0.8, 0.1, 0.1], 'String', "elnyomás:" + -s_rms + " dB", 'BackgroundColor', 'w');
%{
%% Other filters and sistems
M1_A2 = 
M1_A2_i = 
M1_h = 
M1_A3 = 

fir = 

M2_A2 = 
M2_A3 = 

M3_A2 =
M3_A3 =
%}

%settling time  